{"ast":null,"code":"import { useCustomerStore } from '@/stores/customer';\nimport { ref, watch, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'CustomerUpdateCard',\n  props: {\n    customer: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  emits: ['close', 'update-success'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const customerStore = useCustomerStore();\n    const customerForm = ref({\n      ...props.customer\n    });\n    const oldPhone = ref(props.customer.phone);\n    const vipLevels = [{\n      label: '普通用户',\n      value: '0'\n    }, {\n      label: 'VIP1',\n      value: '1'\n    }, {\n      label: 'VIP2',\n      value: '2'\n    }, {\n      label: 'VIP3',\n      value: '3'\n    }, {\n      label: 'VIP4',\n      value: '4'\n    }, {\n      label: 'VIP5',\n      value: '5'\n    }];\n    const emit = __emit;\n    onMounted(() => {\n      // 回显VIP等级\n      if (customerForm.value.customerId) {\n        customerForm.value.vipLevel = customerForm.value.customerId.toString().charAt(0);\n      }\n    });\n    watch(props.customer, newVal => {\n      if (newVal) {\n        customerForm.value = {\n          ...newVal\n        };\n        oldPhone.value = newVal.phone;\n        if (newVal.customerId) {\n          customerForm.value.vipLevel = newVal.customerId.toString().charAt(0);\n        }\n      }\n    });\n    const handleVipChange = val => {\n      // 保留后8位数字\n      let oldId = customerForm.value.customerId ? customerForm.value.customerId.toString() : '';\n      let suffix = oldId.length === 9 ? oldId.slice(1) : Array(8).fill('0').join('');\n      customerForm.value.customerId = val + suffix;\n    };\n    const handleCancel = () => {\n      ElMessage.info('取消更新');\n      emit('close');\n    };\n    const handleUpdate = async () => {\n      if (!customerForm.value.name || !customerForm.value.phone || !customerForm.value.vipLevel) {\n        alert('请填写完整信息');\n        return;\n      }\n      // 传递customerId、name、phone、oldphone\n      await customerStore.updateCustomer({\n        id: customerForm.value.id,\n        name: customerForm.value.name,\n        phone: customerForm.value.phone,\n        oldphone: oldPhone.value\n      });\n      emit('update-success');\n    };\n    const __returned__ = {\n      props,\n      customerStore,\n      customerForm,\n      oldPhone,\n      vipLevels,\n      emit,\n      handleVipChange,\n      handleCancel,\n      handleUpdate,\n      get useCustomerStore() {\n        return useCustomerStore;\n      },\n      ref,\n      watch,\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["useCustomerStore","ref","watch","onMounted","ElMessage","props","__props","customerStore","customerForm","customer","oldPhone","phone","vipLevels","label","value","emit","__emit","customerId","vipLevel","toString","charAt","newVal","handleVipChange","val","oldId","suffix","length","slice","Array","fill","join","handleCancel","info","handleUpdate","name","alert","updateCustomer","id","oldphone"],"sources":["D:/数据库课程设计（饭店系统）/restaurant-ordering-system/src/components/customer/CustomerUpdateCard.vue"],"sourcesContent":["<template>\r\n    <el-card>\r\n        <el-form :model=\"customerForm\" label-width=\"120px\">\r\n            <el-form-item label=\"用户类型\">\r\n                <el-select v-model=\"customerForm.vipLevel\" placeholder=\"请选择用户类型\" @change=\"handleVipChange\">\r\n                    <el-option v-for=\"level in vipLevels\" :key=\"level.value\" :label=\"level.label\" :value=\"level.value\" />\r\n                </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"顾客ID\">\r\n                <el-input v-model=\"customerForm.id\" :disabled=\"true\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"顾客姓名\">\r\n                <el-input v-model=\"customerForm.name\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"顾客电话\">\r\n                <el-input v-model=\"customerForm.phone\" />\r\n            </el-form-item>\r\n            <el-form-item>\r\n                <el-button type=\"primary\" @click=\"handleUpdate\">更新</el-button>\r\n                <el-button @click=\"handleCancel\">取消</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n    </el-card>\r\n</template>\r\n\r\n<script setup>\r\nimport { useCustomerStore } from '@/stores/customer';\r\nimport { ref, watch, defineEmits, defineProps, onMounted } from 'vue';\r\nimport { ElMessage } from 'element-plus';\r\nconst props = defineProps({\r\n    customer: {\r\n        type: Object,\r\n        default: () => ({})\r\n    }\r\n});\r\n\r\nconst customerStore = useCustomerStore();\r\nconst customerForm = ref({ ...props.customer });\r\nconst oldPhone = ref(props.customer.phone);\r\n\r\nconst vipLevels = [\r\n    { label: '普通用户', value: '0' },\r\n    { label: 'VIP1', value: '1' },\r\n    { label: 'VIP2', value: '2' },\r\n    { label: 'VIP3', value: '3' },\r\n    { label: 'VIP4', value: '4' },\r\n    { label: 'VIP5', value: '5' },\r\n];\r\n\r\nconst emit = defineEmits(['close', 'update-success']);\r\n\r\nonMounted(() => {\r\n    // 回显VIP等级\r\n    if (customerForm.value.customerId) {\r\n        customerForm.value.vipLevel = customerForm.value.customerId.toString().charAt(0);\r\n    }\r\n});\r\n\r\nwatch(props.customer, (newVal) => {\r\n    if (newVal) {\r\n        customerForm.value = { ...newVal };\r\n        oldPhone.value = newVal.phone;\r\n        if (newVal.customerId) {\r\n            customerForm.value.vipLevel = newVal.customerId.toString().charAt(0);\r\n        }\r\n    }\r\n});\r\n\r\nconst handleVipChange = (val) => {\r\n    // 保留后8位数字\r\n    let oldId = customerForm.value.customerId ? customerForm.value.customerId.toString() : '';\r\n    let suffix = oldId.length === 9 ? oldId.slice(1) : (Array(8).fill('0').join(''));\r\n    customerForm.value.customerId = val + suffix;\r\n};\r\n\r\nconst handleCancel = () => {\r\n    ElMessage.info('取消更新');\r\n    emit('close');\r\n};\r\n\r\nconst handleUpdate = async () => {\r\n    if (!customerForm.value.name || !customerForm.value.phone || !customerForm.value.vipLevel) {\r\n        alert('请填写完整信息');\r\n        return;\r\n    }\r\n    // 传递customerId、name、phone、oldphone\r\n    await customerStore.updateCustomer({\r\n        id: customerForm.value.id,\r\n        name: customerForm.value.name,\r\n        phone: customerForm.value.phone,\r\n        oldphone: oldPhone.value\r\n    });\r\n    emit('update-success');\r\n};\r\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}