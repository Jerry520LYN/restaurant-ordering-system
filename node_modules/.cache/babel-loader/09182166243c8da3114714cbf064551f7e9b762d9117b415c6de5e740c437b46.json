{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useOrderStore } from '@/stores/order';\nimport { ElMessageBox, ElMessage } from 'element-plus';\nexport default {\n  __name: 'OrderManagementView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const orderStore = useOrderStore();\n    const dateRange = ref([]);\n    const editDialogVisible = ref(false);\n    const editDishForm = ref({\n      orderId: '',\n      dishId: '',\n      quantity: 1\n    });\n    const openEditDialog = row => {\n      editDishForm.value = {\n        orderId: row.orderId,\n        dishId: '',\n        quantity: 1\n      };\n      editDialogVisible.value = true;\n    };\n    const handleEditOrderDishes = async () => {\n      if (!editDishForm.value.dishId || !editDishForm.value.quantity) {\n        ElMessage.warning('请填写菜品ID和数量');\n        return;\n      }\n      await orderStore.editOrderDishes(editDishForm.value.orderId, editDishForm.value.dishId, editDishForm.value.quantity);\n      editDialogVisible.value = false;\n    };\n    const handleSearch = () => {\n      // 只做前端筛选\n    };\n    const filteredOrders = computed(() => {\n      if (!dateRange.value || dateRange.value.length !== 2) {\n        return orderStore.orderList;\n      }\n      const [start, end] = dateRange.value;\n      return orderStore.getOrdersByDateRange(start, end);\n    });\n    const totalRevenue = computed(() => {\n      if (!dateRange.value || dateRange.value.length !== 2) {\n        return orderStore.orderList.reduce((sum, o) => sum + Number(o.totalAmount || o.amount || 0), 0);\n      }\n      const [start, end] = dateRange.value;\n      return orderStore.getRevenueByDateRange(start, end);\n    });\n    const deleteOrder = async row => {\n      await ElMessageBox.confirm(`确定要删除订单\"${row.orderId}\"吗？`, '提示', {\n        type: 'warning'\n      });\n      await orderStore.deleteOrder(row.orderId);\n    };\n    onMounted(orderStore.fetchOrderList);\n    const __returned__ = {\n      orderStore,\n      dateRange,\n      editDialogVisible,\n      editDishForm,\n      openEditDialog,\n      handleEditOrderDishes,\n      handleSearch,\n      filteredOrders,\n      totalRevenue,\n      deleteOrder,\n      ref,\n      computed,\n      onMounted,\n      get useOrderStore() {\n        return useOrderStore;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useOrderStore","ElMessageBox","ElMessage","orderStore","dateRange","editDialogVisible","editDishForm","orderId","dishId","quantity","openEditDialog","row","value","handleEditOrderDishes","warning","editOrderDishes","handleSearch","filteredOrders","length","orderList","start","end","getOrdersByDateRange","totalRevenue","reduce","sum","o","Number","totalAmount","amount","getRevenueByDateRange","deleteOrder","confirm","type","fetchOrderList"],"sources":["D:/数据库课程设计（饭店系统）/restaurant-ordering-system/src/views/OrderManagementView.vue"],"sourcesContent":["<template>\r\n  <div class=\"p-5\">\r\n    <span class=\"flex justify-between items-center mb-5\">\r\n      <h2 class=\"m-0 text-gray-800 text-xl font-bold\">订单信息管理</h2>\r\n      <div class=\"flex gap-2\">\r\n        <el-date-picker v-model=\"dateRange\" type=\"daterange\" range-separator=\"至\" start-placeholder=\"开始日期\" end-placeholder=\"结束日期\" format=\"YYYY-MM-DD\" value-format=\"YYYY-MM-DD\" style=\"margin-right: 10px;\" />\r\n        <el-button type=\"primary\" @click=\"handleSearch\">查询</el-button>\r\n        <el-button type=\"primary\" @click=\"orderStore.fetchOrderList\">刷新订单列表</el-button>\r\n      </div>\r\n    </span>\r\n    <el-table :data=\"filteredOrders\" style=\"width: 100%\" stripe border empty-text=\"暂无订单信息\">\r\n      <el-table-column prop=\"orderId\" label=\"订单ID\" width=\"120\" align=\"center\" />\r\n      <el-table-column prop=\"customerName\" label=\"顾客姓名\" width=\"160\" align=\"center\" />\r\n      <el-table-column prop=\"tableName\" label=\"餐桌\" width=\"120\" align=\"center\" />\r\n      <el-table-column prop=\"orderDate\" label=\"下单日期\" width=\"160\" align=\"center\" />\r\n      <el-table-column prop=\"totalAmount\" label=\"总金额\" width=\"120\" align=\"center\">\r\n        <template #default=\"scope\">¥{{ scope.row.totalAmount }}</template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"220\" align=\"center\" fixed=\"right\">\r\n        <template #default=\"scope\">\r\n          <el-button type=\"primary\" size=\"small\" @click=\"openEditDialog(scope.row)\">编辑</el-button>\r\n          <el-button type=\"danger\" size=\"small\" @click=\"deleteOrder(scope.row)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <div v-if=\"!filteredOrders || filteredOrders.length === 0\" class=\"flex justify-center items-center min-h-50\">\r\n      <el-empty description=\"暂无订单数据\" />\r\n    </div>\r\n    <div class=\"mt-5 text-right text-lg font-bold\">\r\n      <span>总营收：<span class=\"text-green-600\">¥{{ totalRevenue }}</span></span>\r\n    </div>\r\n    <!-- 编辑订单菜品弹窗 -->\r\n    <el-dialog v-model=\"editDialogVisible\" title=\"编辑订单菜品\" width=\"400px\">\r\n      <el-form :model=\"editDishForm\" label-width=\"100px\">\r\n        <el-form-item label=\"菜品ID\">\r\n          <el-input v-model=\"editDishForm.dishId\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"数量\">\r\n          <el-input-number v-model=\"editDishForm.quantity\" :min=\"1\" />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleEditOrderDishes\">添加菜品</el-button>\r\n          <el-button @click=\"editDialogVisible = false\">取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useOrderStore } from '@/stores/order'\r\nimport { ElMessageBox, ElMessage } from 'element-plus'\r\n\r\nconst orderStore = useOrderStore()\r\nconst dateRange = ref([])\r\n\r\nconst editDialogVisible = ref(false)\r\nconst editDishForm = ref({ orderId: '', dishId: '', quantity: 1 })\r\n\r\nconst openEditDialog = (row) => {\r\n  editDishForm.value = { orderId: row.orderId, dishId: '', quantity: 1 }\r\n  editDialogVisible.value = true\r\n}\r\n\r\nconst handleEditOrderDishes = async () => {\r\n  if (!editDishForm.value.dishId || !editDishForm.value.quantity) {\r\n    ElMessage.warning('请填写菜品ID和数量')\r\n    return\r\n  }\r\n  await orderStore.editOrderDishes(editDishForm.value.orderId, editDishForm.value.dishId, editDishForm.value.quantity)\r\n  editDialogVisible.value = false\r\n}\r\n\r\nconst handleSearch = () => {\r\n  // 只做前端筛选\r\n}\r\n\r\nconst filteredOrders = computed(() => {\r\n  if (!dateRange.value || dateRange.value.length !== 2) {\r\n    return orderStore.orderList\r\n  }\r\n  const [start, end] = dateRange.value\r\n  return orderStore.getOrdersByDateRange(start, end)\r\n})\r\n\r\nconst totalRevenue = computed(() => {\r\n  if (!dateRange.value || dateRange.value.length !== 2) {\r\n    return orderStore.orderList.reduce((sum, o) => sum + Number(o.totalAmount || o.amount || 0), 0)\r\n  }\r\n  const [start, end] = dateRange.value\r\n  return orderStore.getRevenueByDateRange(start, end)\r\n})\r\n\r\nconst deleteOrder = async (row) => {\r\n  await ElMessageBox.confirm(`确定要删除订单\"${row.orderId}\"吗？`, '提示', { type: 'warning' })\r\n  await orderStore.deleteOrder(row.orderId)\r\n}\r\n\r\nonMounted(orderStore.fetchOrderList)\r\n</script>\r\n"],"mappings":";;AAiDA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AAC9C,SAASC,aAAa,QAAQ,gBAAgB;AAC9C,SAASC,YAAY,EAAEC,SAAS,QAAQ,cAAc;;;;;;;IAEtD,MAAMC,UAAU,GAAGH,aAAa,CAAC,CAAC;IAClC,MAAMI,SAAS,GAAGP,GAAG,CAAC,EAAE,CAAC;IAEzB,MAAMQ,iBAAiB,GAAGR,GAAG,CAAC,KAAK,CAAC;IACpC,MAAMS,YAAY,GAAGT,GAAG,CAAC;MAAEU,OAAO,EAAE,EAAE;MAAEC,MAAM,EAAE,EAAE;MAAEC,QAAQ,EAAE;IAAE,CAAC,CAAC;IAElE,MAAMC,cAAc,GAAIC,GAAG,IAAK;MAC9BL,YAAY,CAACM,KAAK,GAAG;QAAEL,OAAO,EAAEI,GAAG,CAACJ,OAAO;QAAEC,MAAM,EAAE,EAAE;QAAEC,QAAQ,EAAE;MAAE,CAAC;MACtEJ,iBAAiB,CAACO,KAAK,GAAG,IAAI;IAChC,CAAC;IAED,MAAMC,qBAAqB,GAAG,MAAAA,CAAA,KAAY;MACxC,IAAI,CAACP,YAAY,CAACM,KAAK,CAACJ,MAAM,IAAI,CAACF,YAAY,CAACM,KAAK,CAACH,QAAQ,EAAE;QAC9DP,SAAS,CAACY,OAAO,CAAC,YAAY,CAAC;QAC/B;MACF;MACA,MAAMX,UAAU,CAACY,eAAe,CAACT,YAAY,CAACM,KAAK,CAACL,OAAO,EAAED,YAAY,CAACM,KAAK,CAACJ,MAAM,EAAEF,YAAY,CAACM,KAAK,CAACH,QAAQ,CAAC;MACpHJ,iBAAiB,CAACO,KAAK,GAAG,KAAK;IACjC,CAAC;IAED,MAAMI,YAAY,GAAGA,CAAA,KAAM;MACzB;IAAA,CACD;IAED,MAAMC,cAAc,GAAGnB,QAAQ,CAAC,MAAM;MACpC,IAAI,CAACM,SAAS,CAACQ,KAAK,IAAIR,SAAS,CAACQ,KAAK,CAACM,MAAM,KAAK,CAAC,EAAE;QACpD,OAAOf,UAAU,CAACgB,SAAS;MAC7B;MACA,MAAM,CAACC,KAAK,EAAEC,GAAG,CAAC,GAAGjB,SAAS,CAACQ,KAAK;MACpC,OAAOT,UAAU,CAACmB,oBAAoB,CAACF,KAAK,EAAEC,GAAG,CAAC;IACpD,CAAC,CAAC;IAEF,MAAME,YAAY,GAAGzB,QAAQ,CAAC,MAAM;MAClC,IAAI,CAACM,SAAS,CAACQ,KAAK,IAAIR,SAAS,CAACQ,KAAK,CAACM,MAAM,KAAK,CAAC,EAAE;QACpD,OAAOf,UAAU,CAACgB,SAAS,CAACK,MAAM,CAAC,CAACC,GAAG,EAAEC,CAAC,KAAKD,GAAG,GAAGE,MAAM,CAACD,CAAC,CAACE,WAAW,IAAIF,CAAC,CAACG,MAAM,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;MACjG;MACA,MAAM,CAACT,KAAK,EAAEC,GAAG,CAAC,GAAGjB,SAAS,CAACQ,KAAK;MACpC,OAAOT,UAAU,CAAC2B,qBAAqB,CAACV,KAAK,EAAEC,GAAG,CAAC;IACrD,CAAC,CAAC;IAEF,MAAMU,WAAW,GAAG,MAAOpB,GAAG,IAAK;MACjC,MAAMV,YAAY,CAAC+B,OAAO,CAAC,WAAWrB,GAAG,CAACJ,OAAO,KAAK,EAAE,IAAI,EAAE;QAAE0B,IAAI,EAAE;MAAU,CAAC,CAAC;MAClF,MAAM9B,UAAU,CAAC4B,WAAW,CAACpB,GAAG,CAACJ,OAAO,CAAC;IAC3C,CAAC;IAEDR,SAAS,CAACI,UAAU,CAAC+B,cAAc,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}